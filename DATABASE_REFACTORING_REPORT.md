# ุชูุฑูุฑ ุฅุนุงุฏุฉ ููููุฉ database.py

## ๐ ููุฎุต ุงูุชูููุฐ

ุชู **ุจูุฌุงุญ** ุชูุณูู ููู `database.py` ุฅูู modules ูููุตูุฉ ูููุธูุฉ ูู ูุฌูุฏ `core/database/`.

---

## ๐ ุงููููู ุงูุฌุฏูุฏ

```
core/database/
โโโ __init__.py          # ุงุณุชูุฑุงุฏ ุฌููุน ุงูุฏูุงู ููู backward compatibility
โโโ base.py              # ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุฅุนุฏุงุฏุงุช ุงูุฃุณุงุณูุฉ
โโโ users.py             # ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
โโโ subscriptions.py     # ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช
โโโ downloads.py         # ุฅุฏุงุฑุฉ ุงูุชุญูููุงุช ูุชุชุจุนูุง
โโโ logos.py             # ุฅุฏุงุฑุฉ ุงูููุฌู ูุฅุนุฏุงุฏุงุชู
โโโ libraries.py         # ุฅุฏุงุฑุฉ ุงูููุชุจุงุช ูุงูููุตุงุช
โโโ referrals.py         # ูุธุงู ุงูุฅุญุงูุฉ ูุงูููุงุท
โโโ errors.py            # ูุธุงู ุจูุงุบุงุช ุงูุฃุฎุทุงุก
โโโ settings.py          # ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ (ุตูุชูุงุช ููููุฏ)
```

---

## ๐ ุฅุญุตุงุฆูุงุช ุงูุฏูุงู ูู ูู ููู

| ุงูููู | ุนุฏุฏ ุงูุฏูุงู | ุงููุตู |
|------|-----------|-------|
| `base.py` | 2 | `init_db()`, `ensure_db_connection()` |
| `users.py` | 10 | ุฌููุน ุฏูุงู ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู |
| `subscriptions.py` | 9 | ุฌููุน ุฏูุงู ุงูุงุดุชุฑุงูุงุช ูุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ |
| `downloads.py` | 12 | ุฌููุน ุฏูุงู ุงูุชุญูููุงุช ูุชุชุจุนูุง |
| `logos.py` | 13 | ุฌููุน ุฏูุงู ุฅุฏุงุฑุฉ ุงูููุฌู |
| `libraries.py` | 15 | ุฌููุน ุฏูุงู ุงูููุชุจุงุช ูุงูููุตุงุช |
| `referrals.py` | 6 | ุฌููุน ุฏูุงู ูุธุงู ุงูุฅุญุงูุฉ |
| `errors.py` | 7 | ุฌููุน ุฏูุงู ุจูุงุบุงุช ุงูุฃุฎุทุงุก |
| `settings.py` | 10 | ุฅุนุฏุงุฏุงุช ุงูุตูุชูุงุช ูุงููููุฏ |
| **ุงููุฌููุน** | **84** | **(83 ุฏุงูุฉ ูู ุงูุฃุตู + 1 ุฅุถุงููุฉ)** |

> **ููุงุญุธุฉ**: ุชูุช ุฅุถุงูุฉ ุฏุงูุฉ `get_error_stats()` ูู `errors.py` ูุฏุงูุฉ ูุณุงุนุฏุฉ ุฅุถุงููุฉ.

---

## โ ุงูุชูุงุตูู ุงููุงููุฉ ููู ููู

### 1๏ธโฃ `core/database/base.py`
**ุงููุตู**: ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงููุชุบูุฑุงุช ุงูุฃุณุงุณูุฉ

**ุงููุญุชูู**:
- `MONGODB_URI` - ุฑุงุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช
- `ADMIN_IDS` - ูุงุฆูุฉ ูุนุฑูุงุช ุงููุฏูุฑูู
- `client, db, users_collection, settings_collection` - ูุงุฆูุงุช ุงูุงุชุตุงู
- `init_db()` - ุงูุชุญูู ูู ุงูุงุชุตุงู
- `ensure_db_connection()` - ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุงูุชููุงุฆูุฉ

---

### 2๏ธโฃ `core/database/users.py` 
**ุงููุตู**: ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู

**ุงูุฏูุงู** (10):
1. `is_admin()` - ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุฏูุฑ
2. `add_user()` - ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ
3. `get_user()` - ุฌูุจ ุจูุงูุงุช ูุณุชุฎุฏู
4. `get_all_users()` - ุฌูุจ ุฌููุน ุงููุณุชุฎุฏููู
5. `update_user_language()` - ุชุญุฏูุซ ูุบุฉ ุงููุณุชุฎุฏู
6. `get_user_language()` - ุฌูุจ ูุบุฉ ุงููุณุชุฎุฏู
7. `update_user_interaction()` - ุชุญุฏูุซ ุขุฎุฑ ุชูุงุนู
8. `delete_user()` - ุญุฐู ูุณุชุฎุฏู
9. `get_user_stats()` - ุฌูุจ ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู
10. `get_users_count()` - ุฌูุจ ุนุฏุฏ ุงููุณุชุฎุฏููู

---

### 3๏ธโฃ `core/database/subscriptions.py`
**ุงููุตู**: ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช ูุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ

**ุงูุฏูุงู** (9):
1. `is_subscribed()` - ุงูุชุญูู ูู ุงุดุชุฑุงู ุงููุณุชุฎุฏู
2. `add_subscription()` - ุฅุถุงูุฉ ุงุดุชุฑุงู
3. `get_global_settings()` - ุฌูุจ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ
4. `set_subscription_enabled()` - ุชูุนูู/ุฅููุงู ูุธุงู ุงูุงุดุชุฑุงู
5. `set_welcome_broadcast_enabled()` - ุชูุนูู/ุฅููุงู ุฑุณุงูุฉ ุงูุชุฑุญูุจ
6. `is_subscription_enabled()` - ุงูุชุญูู ูู ุญุงูุฉ ุงูุงุดุชุฑุงู
7. `is_welcome_broadcast_enabled()` - ุงูุชุญูู ูู ุญุงูุฉ ุฑุณุงูุฉ ุงูุชุฑุญูุจ
8. `set_subscription_price()` - ุชุนููู ุณุนุฑ ุงูุงุดุชุฑุงู
9. `get_subscription_price()` - ุฌูุจ ุณุนุฑ ุงูุงุดุชุฑุงู

---

### 4๏ธโฃ `core/database/downloads.py`
**ุงููุตู**: ุฅุฏุงุฑุฉ ุงูุชุญูููุงุช ูุชุชุจุนูุง

**ุงูุฏูุงู** (12):
1. `increment_download_count()` - ุฒูุงุฏุฉ ุนุฏุงุฏ ุงูุชุญูููุงุช
2. `get_daily_download_count()` - ุฌูุจ ุนุฏุฏ ุงูุชุญูููุงุช ุงูููููุฉ
3. `get_total_downloads_count()` - ุฌูุจ ุฅุฌูุงูู ุงูุชุญูููุงุช
4. `reset_daily_downloads()` - ุฅุนุงุฏุฉ ุชุนููู ุงูุชุญูููุงุช ุงูููููุฉ
5. `track_download()` - ุชุชุจุน ุชุญููู ููุตู
6. `get_user_downloads()` - ุฌูุจ ุณุฌู ุชุญูููุงุช ุงููุณุชุฎุฏู
7. `get_download_stats()` - ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูุชุญูููุงุช
8. `get_daily_download_stats()` - ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูุชุญูููุงุช ุงูููููุฉ
9. `generate_daily_report()` - ุชูููุฏ ุชูุฑูุฑ ูููู ุดุงูู
10. `track_download_success()` - ุชุชุจุน ูุฌุงุญ/ูุดู ุงูุชุญูููุงุช
11. `get_download_success_rate()` - ุญุณุงุจ ูุนุฏู ูุฌุงุญ ุงูุชุญูููุงุช
12. `get_user_download_stats()` - ุฌูุจ ุฅุญุตุงุฆูุงุช ุชุญููู ุงููุณุชุฎุฏู

**ุงููุชุบูุฑุงุช**:
- `downloads_collection` - ูุฌููุนุฉ ุงูุชุญูููุงุช ูู MongoDB

---

### 5๏ธโฃ `core/database/logos.py`
**ุงููุตู**: ุฅุฏุงุฑุฉ ุงูููุฌู ูุฌููุน ุฅุนุฏุงุฏุงุชู

**ุงูุฏูุงู** (13):
1. `set_logo_status()` - ุชูุนูู/ุฅููุงู ุงูููุฌู
2. `is_logo_enabled()` - ุงูุชุญูู ูู ุญุงูุฉ ุงูููุฌู
3. `set_logo_animation()` - ุชุนููู ููุน ุญุฑูุฉ ุงูููุฌู
4. `get_logo_animation()` - ุฌูุจ ููุน ุญุฑูุฉ ุงูููุฌู
5. `set_logo_position()` - ุชุนููู ููุถุน ุงูููุฌู
6. `get_logo_position()` - ุฌูุจ ููุถุน ุงูููุฌู
7. `set_logo_size()` - ุชุนููู ุญุฌู ุงูููุฌู
8. `get_logo_size()` - ุฌูุจ ุญุฌู ุงูููุฌู
9. `set_logo_opacity()` - ุชุนููู ุดูุงููุฉ ุงูููุฌู
10. `get_logo_opacity()` - ุฌูุจ ุดูุงููุฉ ุงูููุฌู
11. `get_all_logo_settings()` - ุฌูุจ ุฌููุน ุฅุนุฏุงุฏุงุช ุงูููุฌู
12. `set_logo_target()` - ุชุนููู ุงููุฆุฉ ุงููุณุชูุฏูุฉ ูููุฌู
13. `get_logo_target()` - ุฌูุจ ุงููุฆุฉ ุงููุณุชูุฏูุฉ

---

### 6๏ธโฃ `core/database/libraries.py`
**ุงููุตู**: ุฅุฏุงุฑุฉ ุงูููุชุจุงุช ูุงูููุตุงุช

**ุงูุฏูุงู** (15):
1. `init_library_settings()` - ุชููุฆุฉ ุฅุนุฏุงุฏุงุช ุงูููุชุจุงุช
2. `get_library_settings()` - ุฌูุจ ุฅุนุฏุงุฏุงุช ุงูููุชุจุงุช
3. `update_library_setting()` - ุชุญุฏูุซ ุฅุนุฏุงุฏ ูุญุฏุฏ
4. `toggle_platform()` - ุชูุนูู/ุฅูุบุงุก ุชูุนูู ููุตุฉ
5. `is_platform_allowed()` - ุงูุชุญูู ูู ุงูุณูุงุญ ุจููุตุฉ
6. `get_allowed_platforms()` - ุฌูุจ ูุงุฆูุฉ ุงูููุตุงุช ุงููุณููุญุฉ
7. `add_admin_approval_request()` - ุฅุถุงูุฉ ุทูุจ ููุงููุฉ
8. `get_pending_approvals()` - ุฌูุจ ุทูุจุงุช ุงูููุงููุฉ ุงููุนููุฉ
9. `approve_platform_request()` - ููุงููุฉ ุนูู ุทูุจ ุชูุนูู ููุตุฉ
10. `deny_platform_request()` - ุฑูุถ ุทูุจ ุชูุนูู ููุตุฉ
11. `update_library_status()` - ุชุญุฏูุซ ุญุงูุฉ ููุชุจุฉ
12. `get_library_status()` - ุฌูุจ ุญุงูุฉ ุงูููุชุจุงุช
13. `record_download_attempt()` - ุชุณุฌูู ูุญุงููุฉ ุชุญููู
14. `get_performance_metrics()` - ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุก
15. `reset_performance_metrics()` - ุฅุนุงุฏุฉ ุชุนููู ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุก

---

### 7๏ธโฃ `core/database/referrals.py`
**ุงููุตู**: ูุธุงู ุงูุฅุญุงูุฉ ูุงูููุงุท

**ุงูุฏูุงู** (6):
1. `generate_referral_code()` - ุชูููุฏ ููุฏ ุฅุญุงูุฉ ูุฑูุฏ
2. `track_referral()` - ุชุณุฌูู ุฅุญุงูุฉ ุฌุฏูุฏุฉ ูุน ุฅุดุนุงุฑุงุช
3. `add_referral_points()` - ุฅุถุงูุฉ ููุงุท ุฅุญุงูุฉ
4. `use_no_logo_credit()` - ุงุณุชุฎุฏุงู ููุทุฉ ูู ุฑุตูุฏ ุจุฏูู ููุฌู
5. `get_referral_stats()` - ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูุฅุญุงูุฉ
6. `get_no_logo_credits()` - ุฌูุจ ุฑุตูุฏ ุงูููุฏูููุงุช ุจุฏูู ููุฌู

---

### 8๏ธโฃ `core/database/errors.py`
**ุงููุตู**: ูุธุงู ุจูุงุบุงุช ุงูุฃุฎุทุงุก

**ุงูุฏูุงู** (7):
1. `create_error_report()` - ุฅูุดุงุก ุจูุงุบ ุฎุทุฃ ุฌุฏูุฏ
2. `get_pending_error_reports()` - ุฌูุจ ุงูุจูุงุบุงุช ุงููุนููุฉ
3. `get_all_error_reports()` - ุฌูุจ ุฌููุน ุงูุจูุงุบุงุช
4. `resolve_error_report()` - ุชุญุฏูุฏ ุจูุงุบ ูู "ูุญููู"
5. `get_error_report_by_id()` - ุฌูุจ ุจูุงุบ ูุญุฏุฏ
6. `delete_error_report()` - ุญุฐู ุจูุงุบ
7. `get_error_stats()` - ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูุฃุฎุทุงุก *(ุฌุฏูุฏุฉ)*

**ุงููุชุบูุฑุงุช**:
- `error_reports_collection` - ูุฌููุนุฉ ุงูุจูุงุบุงุช ูู MongoDB

---

### 9๏ธโฃ `core/database/settings.py`
**ุงููุตู**: ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ููุตูุชูุงุช ูุงููููุฏ

**ุงูุฏูุงู** (10):
1. `get_audio_settings()` - ุฌูุจ ุฅุนุฏุงุฏุงุช ุงูุตูุช
2. `set_audio_enabled()` - ุชูุนูู/ุฅููุงู ุชุญููู ุงูุตูุชูุงุช
3. `set_audio_limit_minutes()` - ุชุนููู ุญุฏ ุงูุชุญููู ููุตูุชูุงุช
4. `is_audio_enabled()` - ุงูุชุญูู ูู ุญุงูุฉ ุงูุตูุชูุงุช
5. `get_audio_limit_minutes()` - ุฌูุจ ุญุฏ ุงูุชุญููู ููุตูุชูุงุช
6. `get_general_limits()` - ุฌูุจ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูููููุฏ
7. `set_free_time_limit()` - ุชุนููู ุงูุญุฏ ุงูุฒููู ููููุฏูููุงุช
8. `get_free_time_limit()` - ุฌูุจ ุงูุญุฏ ุงูุฒููู ููููุฏูููุงุช
9. `set_daily_download_limit()` - ุชุนููู ุนุฏุฏ ุงูุชุญูููุงุช ุงูููููุฉ
10. `get_daily_download_limit_setting()` - ุฌูุจ ุนุฏุฏ ุงูุชุญูููุงุช ุงูููููุฉ

---

### ๐ `core/database/__init__.py`
**ุงููุตู**: ููู ุงูุงุณุชูุฑุงุฏ ุงูููุญุฏ - ูููุฑ Backward Compatibility

ูุณุชูุฑุฏ **ุฌููุน** ุงูุฏูุงู ูู ุงููููุงุช ุงููุฎุชููุฉุ ููุง ูุณูุญ ุจุงุณุชุฎุฏุงู:

```python
# ุงูุทุฑููุฉ ุงููุฏููุฉ (ุณุชุจูู ุชุนูู)
from database import add_user, get_user

# ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ (ููุตู ุจูุง)
from core.database import add_user, get_user

# ุงุณุชูุฑุงุฏ ุดุงูู (ููุชูุงูู ุงููุงูู)
from core.database import *
```

---

## ๐ ุงูุชุญูู ูู ุงูุชูุงูู

### โ ุงูููุงุท ุงููููุฉ:
1. **ูู ูุชู ุชุบููุฑ ุฃู ููุทู** - ุฌููุน ุงูุฏูุงู ุชุนูู ุจููุณ ุงูุทุฑููุฉ
2. **ููุณ ุฃุณูุงุก ุงูุฏูุงู** - ูู ูุชู ุชุบููุฑ ุฃู ุงุณู
3. **ููุณ ุงููุนุงููุงุช** - ุฌููุน ุงููุนุงููุงุช ููุง ูู
4. **Backward Compatibility** - ุงูุงุณุชูุฑุงุฏ ูู `core.database` ูุนูู ุชูุงูุงู ูุซู `database`
5. **Logger ููุญุฏ** - ุฌููุน ุงููููุงุช ุชุณุชุฎุฏู `logger` ูู `config`

---

## ๐ฏ ุงูููุงุฆุฏ

1. **ุชูุธูู ุฃูุถู** - ูู ูุฌููุนุฉ ุฏูุงู ูู ููู ูููุตู
2. **ุณูููุฉ ุงูุตูุงูุฉ** - ุฃุณูู ูู ุงูุนุซูุฑ ุนูู ุงูุฏูุงู ูุชุนุฏูููุง
3. **ูุงุจููุฉ ุงูุชูุณุน** - ุณูููุฉ ุฅุถุงูุฉ ุฏูุงู ุฌุฏูุฏุฉ
4. **ุฃุฏุงุก ุฃูุถู** - ุงุณุชูุฑุงุฏ ุฃุณุฑุน (lazy imports)
5. **ููุฏ ุฃูุธู** - ูููุงุช ุตุบูุฑุฉ ูุณููุฉ ุงููุฑุงุกุฉ

---

## ๐ ุฎุทูุงุช ุงูุชุทุจูู

### 1. ุงููุณุฎ ุงูุงุญุชูุงุทู (ููู!)
```bash
cp database.py database.py.backup
```

### 2. ุชุญุฏูุซ ุงูุงุณุชูุฑุงุฏุงุช ูู ุงููุดุฑูุน
ุงุณุชุจุฏู ุฌููุน ุงูุงุณุชูุฑุงุฏุงุช ูู:
```python
from database import add_user, get_user
```

ุฅูู:
```python
from core.database import add_user, get_user
```

ุฃู ูููู ุงูุงุณุชูุฑุงุฑ ูู ุงุณุชุฎุฏุงู ุงูุงุณุชูุฑุงุฏ ุงููุฏูู ูุคูุชุงูุ ูุงูููู ุงูุฃุตูู `database.py` ุณูุจูู ููุชูุงูู.

### 3. ุงูุงุฎุชุจุงุฑ
```python
# ุงุฎุชุจุงุฑ ุณุฑูุน
from core.database import *
print(f"โ Total functions imported: {len([x for x in dir() if not x.startswith('_')])}")
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ูุง ุชุญุฐู `database.py` ุงูุฃุตูู** ุญุชู ุชุชุฃูุฏ ูู ุฃู ูู ุดูุก ูุนูู
2. **ุฑุงุฌุน ุฌููุน ุงูุงุณุชูุฑุงุฏุงุช** ูู ูููุงุช ุงููุดุฑูุน
3. **ุงุฎุชุจุฑ ุฌููุน ุงูุฏูุงู** ููุชุฃูุฏ ูู ุนูููุง
4. **ุงูููู `__init__.py`** ูุถูู ุงูุชูุงูู ุงููุงูู

---

## ๐ ุงูุฎูุงุตุฉ

โ **ุชู ุจูุฌุงุญ ุชูุณูู 83 ุฏุงูุฉ** ูู ููู `database.py` ุฅูู **9 ูููุงุช ููุธูุฉ**

โ **ุงูุญูุงุธ ุนูู ุฌููุน ุงูุฏูุงู** ุจุฏูู ุฃู ุชุบููุฑ ูู ุงูููุทู

โ **Backward Compatibility ูุงูู** - ูููู ุงุณุชุฎุฏุงู ุงููููุงุช ุงูุฌุฏูุฏุฉ ูุจุงุดุฑุฉ

โ **ุชูุธูู ููุทูู** - ูู ูุฆุฉ ุฏูุงู ูู ููููุง ุงูุฎุงุต

โ **ุฌุงูุฒ ููุฅูุชุงุฌ** - ูููู ุงุณุชุฎุฏุงูู ูุจุงุดุฑุฉ ูู ุงููุดุฑูุน

---

## ๐ง ููุฏุนู

ูู ุญุงูุฉ ูุฌูุฏ ุฃู ูุดุงูู:
1. ุฑุงุฌุน ูุฐุง ุงูุชูุฑูุฑ
2. ุชุญูู ูู ุงูุงุณุชูุฑุงุฏุงุช ูู ูููุงุชู
3. ุชุฃูุฏ ูู ูุฌูุฏ `config.py` ูุน `logger`

---

**ุงูุชุงุฑูุฎ**: 2025-11-13  
**ุงูุญุงูุฉ**: โ ููุชูู  
**ุงูุฅุตุฏุงุฑ**: 1.0
